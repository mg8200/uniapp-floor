{"version":3,"sources":["webpack:///I:/uni-app/最美鲜花/components/uni-clientdb/uni-clientdb.vue?2fd5","webpack:///I:/uni-app/最美鲜花/components/uni-clientdb/uni-clientdb.vue?c456","webpack:///I:/uni-app/最美鲜花/components/uni-clientdb/uni-clientdb.vue?f5d9","webpack:///I:/uni-app/最美鲜花/components/uni-clientdb/uni-clientdb.vue?7f95","uni-app:///components/uni-clientdb/uni-clientdb.vue"],"names":[],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAyH;AACzH;AACgE;AACL;;;AAG3D;AACqK;AACrK,gBAAgB,+KAAU;AAC1B,EAAE,kFAAM;AACR,EAAE,uFAAM;AACR,EAAE,gGAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,2FAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACtBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAAsmB,CAAgB,goBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;ACO1nB;AACA;;AAEA;AACA,cADA;AAEA,gBAFA;;AAIA;AACA,YADA;AAEA,oBAFA;;;AAKA;AACA,YADA;AAEA,QAFA;AAGA,OAHA;AAIA,aAJA;AAKA,UALA;AAMA,UANA;AAOA,SAPA;AAQA,OARA;;;AAWA;;;;;;;;;;;;;;;;;;;;;;;;AAwBA;AACA,qBADA;AAEA;AACA;AACA,2BADA;AAEA,aAFA,sBAEA;AACA;AACA,OAJA,EADA;;AAOA;AACA,kBADA;AAEA,iBAFA,EAPA;;AAWA;AACA,kBADA;AAEA,iBAFA,EAXA;;AAeA;AACA,kBADA;AAEA,iBAFA,EAfA;;AAmBA;AACA,kBADA;AAEA,oBAFA,EAnBA;;AAuBA;AACA,kBADA;AAEA,gBAFA,EAvBA;;AA2BA;AACA,kBADA;AAEA,iBAFA,EA3BA;;AA+BA;AACA,6BADA;AAEA,oBAFA,EA/BA;;AAmCA;AACA,kBADA;AAEA,iBAFA,EAnCA;;AAuCA;AACA,4BADA;AAEA,iBAFA,EAvCA;;AA2CA;AACA,6BADA;AAEA,oBAFA,EA3CA;;AA+CA;AACA,mBADA;AAEA,oBAFA,EA/CA,EAFA;;;AAsDA,MAtDA,kBAsDA;AACA;AACA,oBADA;AAEA,kBAFA;AAGA;AACA,iCADA;AAEA,2BAFA;AAGA,gBAHA,EAHA;;AAQA,sBARA;;AAUA,GAjEA;AAkEA,SAlEA,qBAkEA;AACA;;AAEA;AACA;AACA;AACA;AACA,OAFA;AAGA;AACA,KANA,EAMA;AACA;AACA;AACA;AACA,KAVA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoDA;AACA;AACA;AACA,GA5HA;;;;;;;;;;;;;;;AA2IA;AACA,YADA,oBACA,KADA,EACA,KADA,EACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAXA,MAWA;AACA;AACA;;AAEA;AACA,KAnBA;AAoBA,YApBA,sBAoBA;AACA;AACA;AACA;AACA;AACA,KAzBA;AA0BA,WA1BA,qBA0BA;AACA;AACA;AACA,KA7BA;AA8BA,SA9BA,mBA8BA;AACA;AACA;AACA,KAjCA;AAkCA,SAlCA,mBAkCA;AACA;AACA,KApCA;AAqCA,UArCA,kBAqCA,EArCA;;;;;AA0CA,yGAJA,MAIA,QAJA,MAIA,CAHA,QAGA,QAHA,QAGA,CAFA,YAEA,QAFA,YAEA,CADA,cACA,QADA,cACA;AACA;AACA,mCADA;AAEA,4CAFA;AAGA,wBAHA;AAIA;AACA;AACA;AACA;AACA;AACA,SATA;;AAWA,KAtDA;AAuDA,iBAvDA,yBAuDA,QAvDA,EAuDA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,+BADA;;;;AAKA,kBALA,CAGA,IAHA,eAGA,IAHA,CAIA,KAJA,eAIA,KAJA;AAMA;;AAEA;AACA;;AAEA;AACA;AACA,SAFA,MAEA;AACA;AACA;AACA;AACA;AACA,SALA,MAKA;AACA;AACA;AACA;;;;;;;;AAQA,OA7BA,EA6BA,KA7BA,CA6BA;AACA;AACA;AACA;AACA;AACA,OAlCA;AAmCA,KAjGA;AAkGA,YAlGA,sBAkGA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAhBA;;;;;AAqBA,6BArBA,CAmBA,OAnBA,yBAmBA,OAnBA,CAoBA,IApBA,yBAoBA,IApBA;AAsBA;AACA,+BADA;;;AAIA;AACA,KA7HA;AA8HA,eA9HA,uBA8HA,EA9HA,EA8HA,MA9HA,EA8HA,QA9HA,EA8HA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA,kBADA;;;AAIA;AACA;AACA;AACA;;AAEA;AACA,0BADA;AAEA,YAFA,GAEA,IAFA,CAEA;AACA;AACA;AACA;AACA,SAFA,MAEA;AACA;AACA;AACA,OATA,EASA,KATA,CASA;AACA;AACA,8BADA;AAEA,2BAFA;;AAIA,OAdA,EAcA,OAdA,CAcA;AACA;AACA,OAhBA;AAiBA,KAlKA;AAmKA,cAnKA,sBAmKA,GAnKA,EAmKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KA7KA;AA8KA,kBA9KA,0BA8KA,IA9KA,EA8KA,IA9KA,EA8KA;AACA;AACA;AACA,OAFA,MAEA;AACA;AACA;AACA,KApLA,EA3IA,E","file":"components/uni-clientdb/uni-clientdb.js","sourcesContent":["import { render, staticRenderFns, recyclableRender, components } from \"./uni-clientdb.vue?vue&type=template&id=e6870178&\"\nvar renderjs\nimport script from \"./uni-clientdb.vue?vue&type=script&lang=js&\"\nexport * from \"./uni-clientdb.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\runtime\\\\componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"components/uni-clientdb/uni-clientdb.vue\"\nexport default component.exports","export * from \"-!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\templateLoader.js??vue-loader-options!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--16-0!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\template.js!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-uni-app-loader\\\\page-meta.js!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./uni-clientdb.vue?vue&type=template&id=e6870178&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./uni-clientdb.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./uni-clientdb.vue?vue&type=script&lang=js&\"","<template>\r\n  <view>\r\n    <slot :options=\"options\" :data=\"dataList\" :pagination=\"paginationInternal\" :loading=\"loading\" :error=\"errorMessage\"></slot>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\n  const db = uniCloud.database();\r\n  const dbCmd = db.command;\r\n\r\n  const events = {\r\n    load: 'load',\r\n    error: 'error'\r\n  }\r\n  const pageMode = {\r\n    add: 'add',\r\n    replace: 'replace'\r\n  }\r\n\r\n  const attrs = [\r\n    'collection',\r\n    'action',\r\n    'field',\r\n    'pageCurrent',\r\n    'pageSize',\r\n    'getcount',\r\n    'orderby',\r\n    'where'\r\n  ]\r\n\r\n  /**\r\n   * uni-clientdb\r\n   * @description uni-clientdb是一个数据库查询组件，它是对uni-clientdb的js库的再封装。\r\n   * @tutorial https://uniapp.dcloud.net.cn/uniCloud/uni-clientdb-component\r\n   * @property {String} collection 表名\r\n   * @property {String} action 云端执行数据库查询的前或后，触发某个action函数操作，进行预处理或后处理\r\n   * @property {String} field 查询字段，多个字段用 `,` 分割\r\n   * @property {String} orderby 排序字段及正序倒叙设置\r\n   * @property {String} where 查询条件\r\n   * @property {String} pageData = [add|replace] `add` 多次查询的集合, `replace` 当前查询的集合\r\n   * @value add 多次查询的集合\r\n   * @value replace 当前查询的集合\r\n   * @property {Number} pageCurrent 当前页\r\n   * @property {Number} pageSize 每页数据数量\r\n   * @property {Boolean} getone = [true|false] 指定查询结果是否返回数组第一条数据，默认 false。在false情况下返回的是数组，即便只有一条结果，也需要[0]的方式获取。在true下，直接返回结果数据，少一层数组\r\n   * @value true 返回数组第一条数据\r\n   * @value false 返回类型是数组，即便只有一条结果\r\n   * @property {Boolean} getcount 是否查询总数量\r\n   * @property {Boolean} manual 是否手动加载数据，默认为 false，页面onready时自动联网加载数据\r\n   * @value true 开启后需要手动加载数据\r\n   * @value false 页面onready时自动联网加载数据\r\n   * @event {Function} load 成功回调。如联网返回结果后，想修改下数据再渲染界面，则在本方法里对data进行修改\r\n   * @event {Function} error 失败回调\r\n   */\r\n  export default {\r\n    name: 'UniClientdb',\r\n    props: {\r\n      options: {\r\n        type: [Object, Array],\r\n        default () {\r\n          return {}\r\n        }\r\n      },\r\n      collection: {\r\n        type: String,\r\n        default: ''\r\n      },\r\n      action: {\r\n        type: String,\r\n        default: ''\r\n      },\r\n      field: {\r\n        type: String,\r\n        default: ''\r\n      },\r\n      pageData: {\r\n        type: String,\r\n        default: 'add'\r\n      },\r\n      pageCurrent: {\r\n        type: Number,\r\n        default: 1\r\n      },\r\n      pageSize: {\r\n        type: Number,\r\n        default: 20\r\n      },\r\n      getcount: {\r\n        type: [Boolean, String],\r\n        default: false\r\n      },\r\n      orderby: {\r\n        type: String,\r\n        default: ''\r\n      },\r\n      where: {\r\n        type: [String, Object],\r\n        default: ''\r\n      },\r\n      getone: {\r\n        type: [Boolean, String],\r\n        default: false\r\n      },\r\n      manual: {\r\n        type: Boolean,\r\n        default: false\r\n      }\r\n    },\r\n    data() {\r\n      return {\r\n        loading: false,\r\n        dataList: [],\r\n        paginationInternal: {\r\n          current: this.pageCurrent,\r\n          size: this.pageSize,\r\n          count: 0\r\n        },\r\n        errorMessage: ''\r\n      }\r\n    },\r\n    created() {\r\n      this._isEnded = false\r\n\r\n      this.$watch(() => {\r\n        var al = []\r\n        attrs.forEach(key => {\r\n          al.push(this[key])\r\n        })\r\n        return al\r\n      }, () => {\r\n        this.clear()\r\n        this.reset()\r\n        this._execLoadData()\r\n      })\r\n\r\n      // #ifdef H5\r\n      if (process.env.NODE_ENV === 'development') {\r\n        this._debugDataList = []\r\n        if (!window.unidev) {\r\n          window.unidev = {\r\n            clientDB: {\r\n              data: []\r\n            }\r\n          }\r\n        }\r\n        unidev.clientDB.data.push(this._debugDataList)\r\n      }\r\n      // #endif\r\n\r\n      // #ifdef MP-TOUTIAO\r\n      let changeName\r\n      let events = this.$scope.dataset.eventOpts\r\n      for (var i = 0; i < events.length; i++) {\r\n        let event = events[i]\r\n        if (event[0].includes('^load')) {\r\n          changeName = event[1][0][0]\r\n        }\r\n      }\r\n      if (changeName) {\r\n        let parent = this.$parent\r\n        let maxDepth = 16\r\n        this._changeDataFunction = null\r\n        while (parent && maxDepth > 0) {\r\n          let fun = parent[changeName]\r\n          if (fun && typeof fun === 'function') {\r\n            this._changeDataFunction = fun\r\n            maxDepth = 0\r\n            break\r\n          }\r\n          parent = parent.$parent\r\n          maxDepth--;\r\n        }\r\n      }\r\n      // #endif\r\n\r\n      if (!this.manual) {\r\n        this.loadData()\r\n      }\r\n    },\r\n    // #ifdef H5\r\n    beforeDestroy() {\r\n      if (process.env.NODE_ENV === 'development' && window.unidev) {\r\n        var cd = this._debugDataList\r\n        var dl = unidev.clientDB.data\r\n        for (var i = dl.length - 1; i >= 0; i--) {\r\n          if (dl[i] === cd) {\r\n            dl.splice(i, 1)\r\n            break\r\n          }\r\n        }\r\n      }\r\n    },\r\n    // #endif\r\n    methods: {\r\n      loadData(args1, args2) {\r\n        let callback = null\r\n        if (typeof args1 === 'object') {\r\n          if (args1.clear) {\r\n            this.clear()\r\n            this.reset()\r\n          }\r\n          if (args1.current !== undefined) {\r\n            this.paginationInternal.current = args1.current\r\n          }\r\n          if (typeof args2 === 'function') {\r\n            callback = args2\r\n          }\r\n        } else if (typeof args1 === 'function') {\r\n          callback = args1\r\n        }\r\n\r\n        this._execLoadData(callback)\r\n      },\r\n      loadMore() {\r\n        if (this._isEnded) {\r\n          return\r\n        }\r\n        this._execLoadData()\r\n      },\r\n      refresh() {\r\n        this.clear()\r\n        this._execLoadData()\r\n      },\r\n      clear() {\r\n        this._isEnded = false\r\n        this.dataList = []\r\n      },\r\n      reset() {\r\n        this.paginationInternal.current = 1\r\n      },\r\n      remove(id, {\r\n        action,\r\n        callback,\r\n        confirmTitle,\r\n        confirmContent\r\n      } = {}) {\r\n        uni.showModal({\r\n          title: confirmTitle || '提示',\r\n          content: confirmContent || '是否删除该数据',\r\n          showCancel: true,\r\n          success: (res) => {\r\n            if (!res.confirm) {\r\n              return\r\n            }\r\n            this._execRemove(id, action, callback)\r\n          }\r\n        })\r\n      },\r\n      _execLoadData(callback) {\r\n        if (this.loading) {\r\n          return\r\n        }\r\n        this.loading = true\r\n        this.errorMessage = ''\r\n\r\n        this._getExec().then((res) => {\r\n          this.loading = false\r\n          const {\r\n            data,\r\n            count\r\n          } = res.result\r\n          this._isEnded = data.length < this.pageSize\r\n\r\n          callback && callback(data, this._isEnded)\r\n          this._dispatchEvent(events.load, data)\r\n\r\n          if (this.getone) {\r\n            this.dataList = data.length ? data[0] : undefined\r\n          } else if (this.pageData === pageMode.add) {\r\n            this.dataList.push(...data)\r\n            if (this.dataList.length) {\r\n              this.paginationInternal.current++\r\n            }\r\n          } else if (this.pageData === pageMode.replace) {\r\n            this.dataList = data\r\n            this.paginationInternal.count = count\r\n          }\r\n\r\n          // #ifdef H5\r\n          if (process.env.NODE_ENV === 'development') {\r\n            this._debugDataList.length = 0\r\n            this._debugDataList.push(...JSON.parse(JSON.stringify(this.dataList)))\r\n          }\r\n          // #endif\r\n        }).catch((err) => {\r\n          this.loading = false\r\n          this.errorMessage = err\r\n          callback && callback()\r\n          this.$emit(events.error, err)\r\n        })\r\n      },\r\n      _getExec() {\r\n        let exec = db\r\n        if (this.action) {\r\n          exec = exec.action(this.action)\r\n        }\r\n\r\n        exec = db.collection(this.collection)\r\n\r\n        if (!(!this.where || !Object.keys(this.where).length)) {\r\n          exec = exec.where(this.where)\r\n        }\r\n        if (this.field) {\r\n          exec = exec.field(this.field)\r\n        }\r\n        if (this.orderby) {\r\n          exec = exec.orderBy(this.orderby)\r\n        }\r\n\r\n        const {\r\n          current,\r\n          size\r\n        } = this.paginationInternal\r\n        exec = exec.skip(size * (current - 1)).limit(size).get({\r\n          getCount: this.getcount\r\n        })\r\n\r\n        return exec\r\n      },\r\n      _execRemove(id, action, callback) {\r\n        if (!this.collection || !id) {\r\n          return\r\n        }\r\n\r\n        const ids = Array.isArray(id) ? id : [id]\r\n        if (!ids.length) {\r\n          return\r\n        }\r\n\r\n        uni.showLoading({\r\n          mask: true\r\n        })\r\n\r\n        let exec = db\r\n        if (action) {\r\n          exec = exec.action(action)\r\n        }\r\n\r\n        exec.collection(this.collection).where({\r\n          _id: dbCmd.in(ids)\r\n        }).remove().then((res) => {\r\n          callback && callback(res)\r\n          if (this.pageData === pageMode.replace) {\r\n            this.refresh()\r\n          } else {\r\n            this.removeData(ids)\r\n          }\r\n        }).catch((err) => {\r\n          uni.showModal({\r\n            content: err.message,\r\n            showCancel: false\r\n          })\r\n        }).finally(() => {\r\n          uni.hideLoading()\r\n        })\r\n      },\r\n      removeData(ids) {\r\n        let il = ids.slice(0)\r\n        let dl = this.dataList\r\n        for (let i = dl.length - 1; i >= 0; i--) {\r\n          let index = il.indexOf(dl[i]._id)\r\n          if (index >= 0) {\r\n            dl.splice(i, 1)\r\n            il.splice(index, 1)\r\n          }\r\n        }\r\n      },\r\n      _dispatchEvent(type, data) {\r\n        if (this._changeDataFunction) {\r\n          this._changeDataFunction(data, this._isEnded)\r\n        } else {\r\n          this.$emit(type, data, this._isEnded)\r\n        }\r\n      }\r\n    }\r\n  }\r\n</script>\n"],"sourceRoot":""}